<!DOCTYPE html>

<html>
<head>
  <title>proposalsAsHighlights.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="proposals.html">
                proposals.js
              </a>
            
              
              <a class="source" href="featured.html">
                featured.js
              </a>
            
              
              <a class="source" href="style-helpers.html">
                style-helpers.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="proposal.html">
                proposal.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="completedProposalAsFeaturedDetailsItem.html">
                completedProposalAsFeaturedDetailsItem.js
              </a>
            
              
              <a class="source" href="completedProposalsAsFeaturedDetails.html">
                completedProposalsAsFeaturedDetails.js
              </a>
            
              
              <a class="source" href="proposalAsHighlight.html">
                proposalAsHighlight.js
              </a>
            
              
              <a class="source" href="proposalsAsHighlights.html">
                proposalsAsHighlights.js
              </a>
            
              
              <a class="source" href="teachers.html">
                teachers.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>proposalsAsHighlights.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global Stem, Backbone, JST, $*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Backbone view for a collection of proposals from
DonorsChoose.org rendered as a set of highlights
(i.e. “Featured Selections”).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Stem.Views = Stem.Views || {};

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-pi">    'use strict'</span>;

    Stem.Views.ProposalsAsHighlights = Backbone.View.extend({

        template: JST[<span class="hljs-string">'app/scripts/templates/proposalsAsHighlights.ejs'</span>],

        tagName: <span class="hljs-string">'div'</span>,

        id: <span class="hljs-string">''</span>,

        className: <span class="hljs-string">'container'</span>,

        events: {},

        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>We want to watch for <code>reset</code> events on the collection.
For now, that’s the only event we care about because
our collections aren’t dynamic. (Once they’re fetched
from DonorsChoose, they don’t change.) In order to
trigger this event, the <code>{reset: true}</code> options should
be passed as arguments to the collection’s <code>fetch()</code>
method.</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Note that we don’t need to listen for <code>change</code> events.
Backbone fires <code>change</code> events on a collection whenever
a model within that collection changes. Since our
models (like our collections) are static once they’re
fetched from DonorsChoose, this event should not
occur. Even if that changes in the future, we let the
individual model views update themselves with any
changes since we’re not directly rendering any aspect
of the individual models within this view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">'reset'</span>, <span class="hljs-keyword">this</span>.render);
        },

        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>First render the overall template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template());</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Then add the individual proposals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.collection.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(proposal, idx)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We render the individual proposals in rows of four,
so whenever the index is a multiple of four, we
start a new row.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">if</span> (idx % <span class="hljs-number">4</span> === <span class="hljs-number">0</span>) {
                    $(<span class="hljs-string">'&lt;div&gt;'</span>).addClass(<span class="hljs-string">'row'</span>).appendTo(<span class="hljs-keyword">this</span>.$el);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Create a view for the individual proposal, render
it, and add the Bootstrap class that designates it
as a row of 4. When creating the view, we’re passing
in an explicit parent element instead of letting
the model view create it’s own parent (which is the
default). We do that for a couple of reasons.</p>
<p>First, we want to make sure that the element has
the appropriate Bootstrap class for rendering four
in a row. There’s no need for the proposal view
to know how many are in a row, so we handle it
here.</p>
<p>Second, there’s a chance that, in the future, our
proposal models may be dynamic. If that’s the case,
we want to defer completely to the models’ views
to deal with any changes. If we let the model
view create the parent element, then any updates
would overwrite our changes, in particular, they
would remove the Bootstrap class that we need to
add.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">var</span> proposalView = <span class="hljs-keyword">new</span> Stem.Views.ProposalAsHighlight({
                    model: proposal,
                    el: $(<span class="hljs-string">'&lt;div&gt;'</span>).addClass(<span class="hljs-string">'col-sm-3'</span>).get(<span class="hljs-number">0</span>)
                }).render();</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Append the newly rendered proposal view to the
last row of the collection view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'.row'</span>).last().append(proposalView.el);

            }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return <code>this</code> for chaining.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

    });

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
